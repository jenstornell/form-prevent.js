# form-prevent.js

_Version 0.1_

A small vanilla javascript HTML web component to prevent automatic form spam.

**_This does NOT replace server side validation_**

- Form generated with javascript
- Ruleset json file
- Honeypots
- Required field values
- Salt
- Decoding / encoding
- Sleep function

## Usage

### HTML

Somewhere within `<body></body>` in your HTML file.

```html
<form-prevent
  action="https://example.com/your-server-api.php"
  ruleset="ruleset.json"
  salt="4420d1918bbcf7686defdf9560bb5087d20076de5f77b7cb4c3b40bf46ec428b"
>
  <input type="text"" name="username" />

  <input type="hidden" name="honeypot" value="" />
  <input type="hidden" name="has_to_be_blue" value="Doe" />

  <input type="submit" value="Submit" />
</form-prevent>
```

### Javascript

Optimal in most cases is to place the javascript just before `</body>`.

```js
<script src="assets/js/form-prevent.js"></script>
```

### Ruleset

In the `<form-prevent ruleset="ruleset.json">` you specify the path you your ruleset json file. It can look like below.

```json
{
  "honeypot": {
    "match": ""
  },
  "has_to_be_blue": {
    "value": "blue",
    "match": "blue"
  }
}
```

## Events

When the data is submitted events are called, one before and one after. Place these scripts right before `</body>`.

### `submit:before`

Fired just before a form is submitted. It may be used to check some other validation rules if needed.

```html
<script>
  document
    .querySelector("form-prevent")
    .addEventListener("submit:before", (e) => {
      console.log(e.detail);
    });
</script>
```

### `submit:after`

Fired when the data has been submitted and has the collected data in `e.detail`.

```html
<script>
  document
    .querySelector("form-prevent")
    .addEventListener("submit:after", (e) => {
      console.log(e.detail);
    });
</script>
```

## How it works

### Form generated by javascript

It takes the HTML in the custom component, convert it into a form and put it back again.

Just the fact that the form is generated with javascript will prevent many bots from seeing it.

### Ruleset file

In your form there are multiple values. In the ruleset file you set up the rules for the form to be submitted. Some values may be required as empty. Others may be required to something else.

As a user you don't need to make any extra work. Both setting the values and the matching them is made out of the box.

It will make it hard for bots to submit the form. All rules in the ruleset needs to match in order for it to be submitted.

### Honeypots

A honeypot is when a value should be empty but bots still often fill them out. To match nothing in the ruleset file will make it a honeypot.

### Required field values

Instead of like honeypots require empty values, you can require specific values.

### Salt

To add an extra layer of protection, a salt is added. The salt is then mixed with the field value before the encoding takes place.

### Encoding / decoding

The values you specify in the ruleset file are not directly added as values in the form. They are first salted and the converted as a base-64 encoded string. It will also decode it back to match it on submit.

To have something more cryptic to read may not only make it harder, but may also scare some hackers off.

### Sleep

Let's say a bot somehow do break all the above and have access to submit forms. To prevent a huge load of form submits, it will pause for x number of seconds before the form is submitted. For a user it does not disturb much, but it prevents a bot to flood the system.

**_Because the bot can still bypass all the javascript and access the server API directly, you should always validate the data on the server side, as well as include a sleep function there._**
